<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نوتس برو - تطبيق الملاحظات الذكي</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
    <style>
        /* شريط التمرير للعناصر بشكل عام */
::-webkit-scrollbar {
    width: 12px; /* عرض شريط التمرير العمودي */
    height: 12px; /* ارتفاع شريط التمرير الأفقي */
}

/* المسار (الخلفية) لشريط التمرير */
::-webkit-scrollbar-track {
    background: #f1f1f1; /* لون خلفية المسار */
    border-radius: 10px; /* زوايا مدورة */
}

/* المقبض (الجزء المتحرك) من شريط التمرير */
::-webkit-scrollbar-thumb {
    background: #888; /* لون المقبض */
    border-radius: 10px; /* زوايا مدورة */
    border: 3px solid #f1f1f1; /* حد حول المقبض */
}

/* تغيير لون المقبض عند التحويم */
::-webkit-scrollbar-thumb:hover {
    background: #555; /* لون المقبض عند التحويم */
}

/* الزوايا السفلية حيث يتقاطع الشريط الأفقي والعمودي */
::-webkit-scrollbar-corner {
    background: #f1f1f1; /* لون الخلفية */
}
        /* لشريط التمرير في Firefox */

        /* متغيرات التصميم */
:root {
    --primary-color: #6e8efb;
    --secondary-color: #a777e3;
    --accent-color: #4facfe;
    --success-color: #4caf50;
    --danger-color: #f44336;
    --warning-color: #ff9800;
    --info-color: #2196f3;
    --light-color: #f8f9fa;
    --dark-color: #343a40;
    --text-color: #333;
    --text-light: #777;
    --border-color: #e0e0e0;
    --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
}

[data-theme="dark"] {
    --primary-color: #7d9bf9;
    --secondary-color: #b586f0;
    --accent-color: #5fb0ff;
    --light-color: #2d3748;
    --dark-color: #f8f9fa;
    --text-color: #f8f9fa;
    --text-light: #cbd5e0;
    --border-color: #4a5568;
    --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
}

/* التنسيقات العامة */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Tajawal', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background-color: var(--light-color);
    color: var(--text-color);
    transition: var(--transition);
}

/* شاشة التقديم */
.splash-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    transition: opacity 0.5s ease;
}

.splash-content {
    text-align: center;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.splash-content .logo {
    width: 150px;
    height: 150px;
    margin-bottom: 20px;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
}

.splash-content h1 {
    font-size: 3.5rem;
    margin-bottom: 10px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.splash-content p {
    font-size: 1.5rem;
    margin-bottom: 30px;
    opacity: 0.9;
}

.loader {
    border: 5px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top: 5px solid white;
    width: 60px;
    height: 60px;
    animation: spin 1s linear infinite;
    margin: 20px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* التطبيق الرئيسي */
.app-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

.app-header {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    padding: 15px 25px;
    border-radius: 15px;
    margin-bottom: 25px;
    box-shadow: var(--shadow);
    transition: var(--transition);
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
}

.app-info {
    display: flex;
    align-items: center;
    gap: 15px;
}

.app-logo {
    width: 45px;
    height: 45px;
    object-fit: contain;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.datetime {
    text-align: left;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.datetime span {
    font-size: 1rem;
    font-weight: 500;
}

.user-actions {
    display: flex;
    gap: 10px;
}

.user-actions button {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.user-actions button:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}

.app-main {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.search-container {
    display: flex;
    margin-bottom: 20px;
    gap: 10px;
}

.search-container input {
    flex: 1;
    padding: 14px 20px;
    border: 2px solid var(--border-color);
    border-radius: 30px;
    font-size: 1rem;
    outline: none;
    transition: var(--transition);
    background-color: var(--light-color);
    color: var(--text-color);
}

.search-container input:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(110, 142, 251, 0.2);
}

.search-container button {
    width: 50px;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.search-container button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.advanced-search-panel {
    background-color: var(--light-color);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
    display: none;
}

.search-filters {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    align-items: flex-end;
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.filter-group label {
    font-size: 0.9rem;
    color: var(--text-light);
}

.filter-group select, 
.filter-group input {
    padding: 8px 12px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    background-color: var(--light-color);
    color: var(--text-color);
}

#applyFiltersBtn {
    padding: 8px 20px;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: var(--transition);
}

#applyFiltersBtn:hover {
    opacity: 0.9;
    transform: translateY(-2px);
}

.notes-container {
    display: flex;
    gap: 25px;
    flex: 1;
}

.sidebar {
    width: 300px;
    background-color: var(--light-color);
    border-radius: 15px;
    padding: 20px;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    gap: 25px;
    transition: var(--transition);
}

.add-note-btn {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1.05rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: var(--transition);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.add-note-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

.quick-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.quick-action-btn {
    width: 100%;
    padding: 12px;
    background-color: var(--light-color);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 0.95rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: var(--transition);
}

.quick-action-btn:hover {
    background-color: rgba(110, 142, 251, 0.1);
    border-color: var(--primary-color);
}

.categories h3, .stats h3 {
    margin-bottom: 15px;
    color: var(--text-color);
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.categories ul {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.categories li {
    padding: 12px 15px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: var(--transition);
    font-weight: 500;
    color: var(--text-light);
}

.categories li:hover {
    background-color: rgba(110, 142, 251, 0.1);
    color: var(--primary-color);
}

.categories li.active {
    background-color: rgba(110, 142, 251, 0.2);
    color: var(--primary-color);
}

.categories li i {
    font-size: 1.1rem;
    width: 20px;
    text-align: center;
}

.stats {
    margin-top: auto;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px dashed var(--border-color);
    font-size: 0.9rem;
}

.stat-item:last-child {
    border-bottom: none;
}

.stat-item span:first-child {
    color: var(--text-light);
}

.notes-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.notes-list {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
    align-content: flex-start;
}

.note-card {
    background-color: var(--light-color);
    border-radius: 12px;
    padding: 18px;
    box-shadow: var(--shadow);
    cursor: pointer;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    border: 1px solid var(--border-color);
}

.note-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 5px;
    height: 100%;
    background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
}

.note-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
}

.note-card h3 {
    margin-bottom: 12px;
    color: var(--text-color);
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

.note-card h3 i {
    color: var(--primary-color);
    font-size: 0.9em;
}

.note-card p {
    color: var(--text-light);
    font-size: 0.95rem;
    margin-bottom: 15px;
    line-height: 1.5;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.note-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.8rem;
    color: var(--text-light);
}

.note-category {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: bold;
}

.category-personal {
    background: rgba(229, 115, 115, 0.1);
    color: #e57373;
}

.category-work {
    background: rgba(77, 182, 172, 0.1);
    color: #4db6ac;
}

.category-ideas {
    background: rgba(255, 183, 77, 0.1);
    color: #ffb74d;
}

.category-shopping {
    background: rgba(186, 104, 200, 0.1);
    color: #ba68c8;
}

.note-editor-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100;
    opacity: 0;
    pointer-events: none;
    transition: var(--transition);
    backdrop-filter: blur(5px);
}

.note-editor-container.active {
    opacity: 1;
    pointer-events: all;
}

.note-editor {
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    background-color: var(--light-color);
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    transform: translateY(20px);
    transition: var(--transition);
}

.note-editor-container.active .note-editor {
    transform: translateY(0);
}

.editor-header {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.editor-header input {
    flex: 1;
    min-width: 200px;
    padding: 12px 15px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 1.2rem;
    outline: none;
    background-color: var(--light-color);
    color: var(--text-color);
}

.editor-tools {
    display: flex;
    gap: 8px;
}

.editor-tools select {
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: var(--light-color);
    color: var(--text-color);
    cursor: pointer;
}

.editor-tools button {
    width: 40px;
    height: 40px;
    border: none;
    border-radius: 8px;
    background-color: rgba(110, 142, 251, 0.1);
    color: var(--primary-color);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.editor-tools button:hover {
    background-color: rgba(110, 142, 251, 0.2);
}

#noteContent {
    flex: 1;
    width: 100%;
    padding: 15px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 1rem;
    line-height: 1.6;
    outline: none;
    resize: none;
    background-color: var(--light-color);
    color: var(--text-color);
    margin-bottom: 15px;
    min-height: 300px;
}

.image-preview {
    margin-bottom: 15px;
    display: none;
}

.image-preview img {
    max-width: 100%;
    max-height: 200px;
    border-radius: 8px;
    object-fit: contain;
    display: block;
    margin: 0 auto;
}

.editor-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
}

.reminder-info {
    font-size: 0.85rem;
    color: var(--text-light);
    display: flex;
    align-items: center;
    gap: 8px;
}

.reminder-info i {
    color: var(--warning-color);
}

.editor-actions {
    display: flex;
    gap: 10px;
}

.editor-actions button {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: var(--transition);
}

#saveNoteBtn {
    background: var(--success-color);
    color: white;
}

#saveNoteBtn:hover {
    background: #43a047;
}

#cancelEditBtn {
    background: var(--danger-color);
    color: white;
}

#cancelEditBtn:hover {
    background: #e53935;
}

.delete-btn {
    background: var(--warning-color);
    color: white;
}

.delete-btn:hover {
    background: #fb8c00;
}

.empty-notes {
    grid-column: 1 / -1;
    text-align: center;
    padding: 60px 20px;
    color: var(--text-light);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
}

.empty-notes i {
    font-size: 4rem;
    color: var(--border-color);
    opacity: 0.5;
}

.empty-notes h3 {
    font-weight: normal;
    font-size: 1.5rem;
}

/* النوافذ المنبثقة */
.reminder-modal,
.image-upload-modal,
.format-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 200;
    opacity: 0;
    pointer-events: none;
    transition: var(--transition);
}

.reminder-modal.active,
.image-upload-modal.active,
.format-modal.active {
    opacity: 1;
    pointer-events: all;
}

.modal-content {
    background-color: var(--light-color);
    border-radius: 12px;
    padding: 25px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    transform: translateY(20px);
    transition: var(--transition);
}

.reminder-modal.active .modal-content,
.image-upload-modal.active .modal-content,
.format-modal.active .modal-content {
    transform: translateY(0);
}

.modal-content h3 {
    margin-bottom: 20px;
    color: var(--text-color);
    display: flex;
    align-items: center;
    gap: 10px;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: var(--text-light);
    font-size: 0.9rem;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: var(--light-color);
    color: var(--text-color);
}

.upload-options {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
}

.upload-option {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.upload-btn {
    padding: 12px;
    background-color: rgba(110, 142, 251, 0.1);
    color: var(--primary-color);
    border: 1px dashed var(--primary-color);
    border-radius: 8px;
    text-align: center;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.upload-btn:hover {
    background-color: rgba(110, 142, 251, 0.2);
}

#imageUrlInput {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: var(--light-color);
    color: var(--text-color);
}

#loadImageUrlBtn {
    width: 100%;
    padding: 10px;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: var(--transition);
}

#loadImageUrlBtn:hover {
    opacity: 0.9;
}

.format-tools {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
}

.format-tools button {
    width: 45px;
    height: 45px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: var(--light-color);
    color: var(--text-color);
    cursor: pointer;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.format-tools button:hover {
    background-color: rgba(110, 142, 251, 0.1);
    color: var(--primary-color);
}

.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.modal-actions button {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    cursor: pointer;
    transition: var(--transition);
}

.modal-actions button:first-child {
    background: var(--primary-color);
    color: white;
}

.modal-actions button:last-child {
    background: var(--light-color);
    color: var(--text-color);
    border: 1px solid var(--border-color);
}

/* الإشعارات */
.notification {
    position: fixed;
    bottom: 30px;
    right: 30px;
    padding: 15px 25px;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    z-index: 300;
    transform: translateY(100px);
    opacity: 0;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 10px;
}

.notification.show {
    transform: translateY(0);
    opacity: 1;
}

.notification i {
    font-size: 1.2rem;
}

/* التصميم المتجاوب */
@media (max-width: 992px) {
    .notes-container {
        flex-direction: column;
    }
    
    .sidebar {
        width: 100%;
    }
    
    .notes-list {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
}

@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .datetime {
        align-items: flex-start;
    }
    
    .search-container {
        flex-direction: column;
    }
    
    .search-container input {
        width: 100%;
    }
    
    .search-container button {
        width: 100%;
        border-radius: 30px;
        height: 50px;
    }
    
    .note-editor {
        width: 95%;
        padding: 15px;
    }
    
    .editor-header {
        flex-direction: column;
        gap: 10px;
    }
    
    .editor-header input {
        width: 100%;
    }
    
    .editor-tools {
        width: 100%;
        justify-content: flex-end;
    }
    
    .editor-footer {
        flex-direction: column-reverse;
    }
    
    .editor-actions {
        width: 100%;
        justify-content: space-between;
    }
    
    .editor-actions button {
        flex: 1;
        justify-content: center;
    }
}

@media (max-width: 480px) {
    .notes-list {
        grid-template-columns: 1fr;
    }
    
    .app-container {
        padding: 15px;
    }
    
    .app-header {
        padding: 15px;
    }
    
    .modal-content {
        padding: 20px;
    }
}
    </style>
</head>
<body>
    <!-- شاشة التقديم -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-content animate__animated animate__fadeIn">
            <img src="https://img.icons8.com/?size=80&id=0Jj2OFqGGRVZ&format=png" alt="Nots Pro Logo" class="logo animate__animated animate__bounce">
            <h1 class="animate__animated animate__fadeInUp">نوتس برو</h1>
            <p class="animate__animated animate__fadeInUp animate__delay-1s">تطبيق الملاحظات الذكي المتكامل</p>
            <div class="loader animate__animated animate__fadeIn animate__delay-2s"></div>
        </div>
    </div>

    <!-- التطبيق الرئيسي -->
    <div class="app-container" id="appContainer" style="display: none;">
        <header class="app-header">
            <div class="header-content">
                <div class="app-info">
                    <img src="https://img.icons8.com/?size=80&id=0Jj2OFqGGRVZ&format=png" alt="Nots Pro Logo" class="app-logo">
                    <h1>نوتس برو</h1>
                </div>
                <div class="datetime">
                    <span id="currentDate"></span>
                    <span id="currentTime"></span>
                </div>
                <div class="user-actions">
                    <button id="syncBtn" title="مزامنة مع السحابة"><i class="fas fa-cloud-upload-alt"></i></button>
                    <button id="themeToggle" title="تبديل الوضع"><i class="fas fa-moon"></i></button>
                </div>
            </div>
        </header>

        <main class="app-main">
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="ابحث عن ملاحظة...">
                <button id="searchBtn"><i class="fas fa-search"></i></button>
                <button id="advancedSearchBtn" title="بحث متقدم"><i class="fas fa-sliders-h"></i></button>
            </div>

            <div class="advanced-search-panel" id="advancedSearchPanel">
                <div class="search-filters">
                    <div class="filter-group">
                        <label for="filterCategory">الفئة:</label>
                        <select id="filterCategory">
                            <option value="all">الكل</option>
                            <option value="personal">شخصية</option>
                            <option value="work">عمل</option>
                            <option value="ideas">أفكار</option>
                            <option value="shopping">تسوق</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterDateFrom">من تاريخ:</label>
                        <input type="date" id="filterDateFrom">
                    </div>
                    <div class="filter-group">
                        <label for="filterDateTo">إلى تاريخ:</label>
                        <input type="date" id="filterDateTo">
                    </div>
                    <button id="applyFiltersBtn">تطبيق الفلتر</button>
                </div>
            </div>

            <div class="notes-container">
                <div class="sidebar">
                    <button class="add-note-btn" id="addNoteBtn">
                        <i class="fas fa-plus"></i> إضافة ملاحظة جديدة
                    </button>
                    
                    <div class="quick-actions">
                        <button class="quick-action-btn" id="exportPdfBtn">
                            <i class="fas fa-file-pdf"></i> تصدير PDF
                        </button>
                        <button class="quick-action-btn" id="exportTxtBtn">
                            <i class="fas fa-file-alt"></i> تصدير نصي
                        </button>
                    </div>

                    <div class="categories">
                        <h3><i class="fas fa-tags"></i> الفئات</h3>
                        <ul>
                            <li class="active" data-category="all"><i class="fas fa-list"></i> الكل</li>
                            <li data-category="work"><i class="fas fa-briefcase"></i> العمل</li>
                            <li data-category="personal"><i class="fas fa-home"></i> شخصية</li>
                            <li data-category="ideas"><i class="fas fa-lightbulb"></i> أفكار</li>
                            <li data-category="shopping"><i class="fas fa-shopping-cart"></i> تسوق</li>
                        </ul>
                    </div>

                    <div class="stats">
                        <h3><i class="fas fa-chart-pie"></i> الإحصائيات</h3>
                        <div class="stat-item">
                            <span>عدد الملاحظات:</span>
                            <span id="totalNotesCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span>آخر تحديث:</span>
                            <span id="lastUpdated">--</span>
                        </div>
                    </div>
                </div>

                <div class="notes-content">
                    <div class="notes-list" id="notesList">
                        <!-- الملاحظات ستضاف هنا ديناميكيًا -->
                    </div>

                    <div class="note-editor-container" id="noteEditorContainer">
                        <div class="note-editor" id="noteEditor">
                            <div class="editor-header">
                                <input type="text" id="noteTitle" placeholder="عنوان الملاحظة">
                                <div class="editor-tools">
                                    <select id="noteCategory">
                                        <option value="personal">شخصية</option>
                                        <option value="work">عمل</option>
                                        <option value="ideas">أفكار</option>
                                        <option value="shopping">تسوق</option>
                                    </select>
                                    <button id="setReminderBtn" title="إضافة تذكير"><i class="fas fa-bell"></i></button>
                                    <button id="addImageBtn" title="إضافة صورة"><i class="fas fa-image"></i></button>
                                    <button id="formatTextBtn" title="تنسيق النص"><i class="fas fa-text-height"></i></button>
                                </div>
                            </div>
                            <textarea id="noteContent" placeholder="اكتب ملاحظتك هنا..."></textarea>
                            <div class="image-preview" id="imagePreview"></div>
                            <div class="editor-footer">
                                <div class="reminder-info" id="reminderInfo"></div>
                                <div class="editor-actions">
                                    <button id="saveNoteBtn"><i class="fas fa-save"></i> حفظ</button>
                                    <button id="cancelEditBtn"><i class="fas fa-times"></i> إلغاء</button>
                                    <button id="deleteNoteBtn" class="delete-btn"><i class="fas fa-trash"></i> حذف</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- نافذة التذكير -->
        <div class="reminder-modal" id="reminderModal">
            <div class="modal-content">
                <h3><i class="fas fa-bell"></i> إضافة تذكير</h3>
                <div class="form-group">
                    <label for="reminderDate">التاريخ:</label>
                    <input type="date" id="reminderDate">
                </div>
                <div class="form-group">
                    <label for="reminderTime">الوقت:</label>
                    <input type="time" id="reminderTime">
                </div>
                <div class="form-group">
                    <label for="reminderRepeat">التكرار:</label>
                    <select id="reminderRepeat">
                        <option value="none">لا يوجد</option>
                        <option value="daily">يومي</option>
                        <option value="weekly">أسبوعي</option>
                        <option value="monthly">شهري</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button id="saveReminderBtn">حفظ التذكير</button>
                    <button id="cancelReminderBtn">إلغاء</button>
                </div>
            </div>
        </div>

        <!-- نافذة تحميل الصورة -->
        <div class="image-upload-modal" id="imageUploadModal">
            <div class="modal-content">
                <h3><i class="fas fa-image"></i> إضافة صورة</h3>
                <div class="upload-options">
                    <div class="upload-option">
                        <input type="file" id="imageUploadInput" accept="image/*">
                        <label for="imageUploadInput" class="upload-btn">
                            <i class="fas fa-upload"></i> تحميل صورة
                        </label>
                    </div>
                    <div class="upload-option">
                        <input type="text" id="imageUrlInput" placeholder="رابط الصورة">
                        <button id="loadImageUrlBtn">تحميل من الرابط</button>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="cancelImageUploadBtn">إلغاء</button>
                </div>
            </div>
        </div>

        <!-- نافذة التنسيق -->
        <div class="format-modal" id="formatModal">
            <div class="modal-content">
                <h3><i class="fas fa-text-height"></i> تنسيق النص</h3>
                <div class="format-tools">
                    <button data-format="bold"><i class="fas fa-bold"></i></button>
                    <button data-format="italic"><i class="fas fa-italic"></i></button>
                    <button data-format="underline"><i class="fas fa-underline"></i></button>
                    <button data-format="heading"><i class="fas fa-heading"></i></button>
                    <button data-format="list-ul"><i class="fas fa-list-ul"></i></button>
                    <button data-format="list-ol"><i class="fas fa-list-ol"></i></button>
                    <button data-format="link"><i class="fas fa-link"></i></button>
                </div>
                <div class="modal-actions">
                    <button id="applyFormatBtn">تطبيق</button>
                    <button id="cancelFormatBtn">إلغاء</button>
                </div>
            </div>
        </div>

        <!-- إشعارات -->
        <div class="notification" id="notification"></div>
    </div>

    <!-- مكتبات إضافية -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.5/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.5/vfs_fonts.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    
    <script>
    // تهيئة Firebase (استبدل بقيم مشروعك الخاص)
const firebaseConfig = {
    apiKey: "AIzaSyYOUR_API_KEY",
    authDomain: "your-project-id.firebaseapp.com",
    projectId: "your-project-id",
    storageBucket: "your-project-id.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  
  // تهيئة Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();
  
  // حالة التطبيق
  const state = {
    notes: JSON.parse(localStorage.getItem('notes')) || [],
    currentNoteId: null,
    currentCategory: 'all',
    currentTheme: localStorage.getItem('theme') || 'light',
    currentReminder: null,
    currentImage: null,
    user: null,
    searchQuery: '',
    advancedFilters: {
      category: 'all',
      dateFrom: '',
      dateTo: ''
    }
  };
  
  // عناصر DOM
  const elements = {
    splashScreen: document.getElementById('splashScreen'),
    appContainer: document.getElementById('appContainer'),
    notesList: document.getElementById('notesList'),
    noteEditorContainer: document.getElementById('noteEditorContainer'),
    addNoteBtn: document.getElementById('addNoteBtn'),
    saveNoteBtn: document.getElementById('saveNoteBtn'),
    cancelEditBtn: document.getElementById('cancelEditBtn'),
    deleteNoteBtn: document.getElementById('deleteNoteBtn'),
    noteTitle: document.getElementById('noteTitle'),
    noteContent: document.getElementById('noteContent'),
    noteCategory: document.getElementById('noteCategory'),
    searchInput: document.getElementById('searchInput'),
    searchBtn: document.getElementById('searchBtn'),
    advancedSearchBtn: document.getElementById('advancedSearchBtn'),
    advancedSearchPanel: document.getElementById('advancedSearchPanel'),
    currentDate: document.getElementById('currentDate'),
    currentTime: document.getElementById('currentTime'),
    categoryItems: document.querySelectorAll('.categories li'),
    syncBtn: document.getElementById('syncBtn'),
    themeToggle: document.getElementById('themeToggle'),
    totalNotesCount: document.getElementById('totalNotesCount'),
    lastUpdated: document.getElementById('lastUpdated'),
    setReminderBtn: document.getElementById('setReminderBtn'),
    reminderInfo: document.getElementById('reminderInfo'),
    reminderModal: document.getElementById('reminderModal'),
    saveReminderBtn: document.getElementById('saveReminderBtn'),
    cancelReminderBtn: document.getElementById('cancelReminderBtn'),
    reminderDate: document.getElementById('reminderDate'),
    reminderTime: document.getElementById('reminderTime'),
    reminderRepeat: document.getElementById('reminderRepeat'),
    addImageBtn: document.getElementById('addImageBtn'),
    imagePreview: document.getElementById('imagePreview'),
    imageUploadModal: document.getElementById('imageUploadModal'),
    imageUploadInput: document.getElementById('imageUploadInput'),
    imageUrlInput: document.getElementById('imageUrlInput'),
    loadImageUrlBtn: document.getElementById('loadImageUrlBtn'),
    cancelImageUploadBtn: document.getElementById('cancelImageUploadBtn'),
    formatTextBtn: document.getElementById('formatTextBtn'),
    formatModal: document.getElementById('formatModal'),
    applyFormatBtn: document.getElementById('applyFormatBtn'),
    cancelFormatBtn: document.getElementById('cancelFormatBtn'),
    formatTools: document.querySelectorAll('.format-tools button'),
    exportPdfBtn: document.getElementById('exportPdfBtn'),
    exportTxtBtn: document.getElementById('exportTxtBtn'),
    notification: document.getElementById('notification'),
    filterCategory: document.getElementById('filterCategory'),
    filterDateFrom: document.getElementById('filterDateFrom'),
    filterDateTo: document.getElementById('filterDateTo'),
    applyFiltersBtn: document.getElementById('applyFiltersBtn')
  };
  
  // ======================
  // وظائف التطبيق الأساسية
  // ======================
  
  /**
   * تهيئة التطبيق
   */
  function initApp() {
    loadFromLocalStorage();
    setupEventListeners();
    updateDateTime();
    displayNotes();
    
    // التحقق من التذكيرات كل دقيقة
    setInterval(checkReminders, 60000);
    
    // تحديث التاريخ والوقت كل ثانية
    setInterval(updateDateTime, 1000);
    
    // إخفاء شاشة التقديم بعد 3 ثواني
    setTimeout(() => {
      elements.splashScreen.style.opacity = '0';
      setTimeout(() => {
        elements.splashScreen.style.display = 'none';
        elements.appContainer.style.display = 'flex';
        applyTheme();
      }, 500);
    }, 3000);
  }
  
  /**
   * إعداد مستمعات الأحداث
   */
  function setupEventListeners() {
    // أحداث الملاحظات
    elements.addNoteBtn.addEventListener('click', () => openNoteEditor());
    elements.saveNoteBtn.addEventListener('click', saveNote);
    elements.cancelEditBtn.addEventListener('click', closeNoteEditor);
    elements.deleteNoteBtn.addEventListener('click', deleteNote);
  
    // أحداث البحث
    elements.searchBtn.addEventListener('click', displayNotes);
    elements.searchInput.addEventListener('keyup', (e) => {
      if (e.key === 'Enter') displayNotes();
    });
    elements.searchInput.addEventListener('input', (e) => {
      state.searchQuery = e.target.value;
      displayNotes();
    });
  
    elements.advancedSearchBtn.addEventListener('click', toggleAdvancedSearch);
    elements.applyFiltersBtn.addEventListener('click', applyAdvancedFilters);
  
    // أحداث الفئات
    elements.categoryItems.forEach(item => {
      item.addEventListener('click', () => {
        elements.categoryItems.forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        state.currentCategory = item.dataset.category;
        displayNotes();
      });
    });
  
    // أحداث المزامنة والسمة
    elements.syncBtn.addEventListener('click', syncWithFirebase);
    elements.themeToggle.addEventListener('click', toggleTheme);
  
    // أحداث التذكير
    elements.setReminderBtn.addEventListener('click', openReminderModal);
    elements.saveReminderBtn.addEventListener('click', saveReminder);
    elements.cancelReminderBtn.addEventListener('click', () => {
      elements.reminderModal.classList.remove('active');
    });
  
    // أحداث الصور
    elements.addImageBtn.addEventListener('click', openImageUploadModal);
    elements.imageUploadInput.addEventListener('change', handleImageUpload);
    elements.loadImageUrlBtn.addEventListener('click', loadImageFromUrl);
    elements.cancelImageUploadBtn.addEventListener('click', () => {
      elements.imageUploadModal.classList.remove('active');
    });
  
    // أحداث تنسيق النص
    elements.formatTextBtn.addEventListener('click', openFormatModal);
    elements.cancelFormatBtn.addEventListener('click', () => {
      elements.formatModal.classList.remove('active');
    });
  
    elements.formatTools.forEach(tool => {
      tool.addEventListener('click', () => {
        applyTextFormat(tool.dataset.format);
      });
    });
  
    // أحداث التصدير
    elements.exportPdfBtn.addEventListener('click', exportToPdf);
    elements.exportTxtBtn.addEventListener('click', exportToTxt);
  }
  
  /**
   * عرض الملاحظات مع التصفية
   */
  function displayNotes() {
    elements.notesList.innerHTML = '';
    
    let filteredNotes = filterNotes();
    
    // تحديث عدد الملاحظات
    elements.totalNotesCount.textContent = filteredNotes.length;
    
    if (filteredNotes.length === 0) {
      showEmptyState();
      return;
    }
    
    // فرز الملاحظات حسب آخر تعديل
    filteredNotes.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
    
    filteredNotes.forEach(note => {
      createNoteCard(note);
    });
  }
  
  /**
   * تصفية الملاحظات حسب البحث والفلاتر
   */
  function filterNotes() {
    let filteredNotes = [...state.notes];
    
    // تصفية حسب الفئة الرئيسية
    if (state.currentCategory !== 'all') {
      filteredNotes = filteredNotes.filter(note => note.category === state.currentCategory);
    }
    
    // تصفية حسب البحث
    if (state.searchQuery) {
      const searchTerm = state.searchQuery.toLowerCase();
      filteredNotes = filteredNotes.filter(note => 
        note.title.toLowerCase().includes(searchTerm) || 
        note.content.toLowerCase().includes(searchTerm)
      );
    }
    
    // تصفية متقدمة
    if (state.advancedFilters.category !== 'all') {
      filteredNotes = filteredNotes.filter(note => note.category === state.advancedFilters.category);
    }
    
    if (state.advancedFilters.dateFrom) {
      const fromDate = new Date(state.advancedFilters.dateFrom);
      filteredNotes = filteredNotes.filter(note => new Date(note.createdAt) >= fromDate);
    }
    
    if (state.advancedFilters.dateTo) {
      const toDate = new Date(state.advancedFilters.dateTo);
      filteredNotes = filteredNotes.filter(note => new Date(note.createdAt) <= toDate);
    }
    
    return filteredNotes;
  }
  
  /**
   * إنشاء بطاقة ملاحظة
   */
  function createNoteCard(note) {
    const noteElement = document.createElement('div');
    noteElement.className = 'note-card';
    
    const categoryIcon = getCategoryIcon(note.category);
    const hasReminder = note.reminder ? `<div class="reminder-badge"><i class="fas fa-bell"></i></div>` : '';
    
    noteElement.innerHTML = `
      <h3><i class="fas ${categoryIcon}"></i> ${note.title}</h3>
      <p>${note.content.substring(0, 100)}${note.content.length > 100 ? '...' : ''}</p>
      <div class="note-meta">
        <span>${new Date(note.updatedAt).toLocaleDateString('ar-EG')}</span>
        <span class="note-category category-${note.category}">
          ${getCategoryName(note.category)}
        </span>
      </div>
      ${hasReminder}
    `;
    
    noteElement.addEventListener('click', () => openNoteEditor(note.id));
    elements.notesList.appendChild(noteElement);
  }
  
  /**
   * عرض حالة عدم وجود ملاحظات
   */
  function showEmptyState() {
    elements.notesList.innerHTML = `
      <div class="empty-notes">
        <i class="far fa-clipboard"></i>
        <h3>لا توجد ملاحظات</h3>
        <p>اضغط على زر "إضافة ملاحظة جديدة" لإنشاء ملاحظتك الأولى</p>
      </div>
    `;
  }
  
  /**
   * فتح محرر الملاحظات
   */
  function openNoteEditor(noteId = null) {
    state.currentNoteId = noteId;
    state.currentReminder = null;
    state.currentImage = null;
    elements.imagePreview.style.display = 'none';
    elements.reminderInfo.textContent = '';
    
    if (noteId) {
      // تحرير ملاحظة موجودة
      const note = state.notes.find(n => n.id === noteId);
      elements.noteTitle.value = note.title;
      elements.noteContent.value = note.content;
      elements.noteCategory.value = note.category;
      elements.deleteNoteBtn.style.display = 'flex';
      
      if (note.reminder) {
        state.currentReminder = note.reminder;
        updateReminderInfo();
      }
      
      if (note.image) {
        state.currentImage = note.image;
        elements.imagePreview.innerHTML = `<img src="${note.image}" alt="صورة الملاحظة">`;
        elements.imagePreview.style.display = 'block';
      }
    } else {
      // ملاحظة جديدة
      elements.noteTitle.value = '';
      elements.noteContent.value = '';
      elements.noteCategory.value = 'personal';
      elements.deleteNoteBtn.style.display = 'none';
    }
    
    elements.noteEditorContainer.classList.add('active');
    elements.noteTitle.focus();
  }
  
  /**
   * حفظ الملاحظة
   */
  function saveNote() {
    const title = elements.noteTitle.value.trim();
    const content = elements.noteContent.value.trim();
    const category = elements.noteCategory.value;
    
    if (!title || !content) {
      showNotification('الرجاء إدخال عنوان ومحتوى للملاحظة', 'error');
      return;
    }
    
    const now = new Date().toISOString();
    
    if (state.currentNoteId) {
      // تحديث ملاحظة موجودة
      const noteIndex = state.notes.findIndex(n => n.id === state.currentNoteId);
      state.notes[noteIndex] = {
        ...state.notes[noteIndex],
        title,
        content,
        category,
        reminder: state.currentReminder,
        image: state.currentImage,
        updatedAt: now
      };
      showNotification('تم تحديث الملاحظة بنجاح', 'success');
    } else {
      // إضافة ملاحظة جديدة
      const newNote = {
        id: Date.now().toString(),
        title,
        content,
        category,
        reminder: state.currentReminder,
        image: state.currentImage,
        createdAt: now,
        updatedAt: now
      };
      state.notes.unshift(newNote);
      showNotification('تم إضافة الملاحظة بنجاح', 'success');
    }
    
    saveToLocalStorage();
    displayNotes();
    closeNoteEditor();
  }
  
  /**
   * حذف الملاحظة
   */
  function deleteNote() {
    if (!state.currentNoteId) return;
    
    if (confirm('هل أنت متأكد من حذف هذه الملاحظة؟')) {
      state.notes = state.notes.filter(note => note.id !== state.currentNoteId);
      saveToLocalStorage();
      displayNotes();
      closeNoteEditor();
      showNotification('تم حذف الملاحظة بنجاح', 'success');
    }
  }
  
  /**
   * إغلاق محرر الملاحظات
   */
  function closeNoteEditor() {
    elements.noteEditorContainer.classList.remove('active');
    state.currentNoteId = null;
    state.currentReminder = null;
    state.currentImage = null;
  }
  
  // ======================
  // وظائف التذكيرات
  // ======================
  
  /**
   * فتح نافذة التذكير
   */
  function openReminderModal() {
    if (state.currentReminder) {
      // إذا كان هناك تذكير موجود، تعبئة البيانات
      const reminderDateObj = new Date(state.currentReminder.date);
      elements.reminderDate.value = reminderDateObj.toISOString().split('T')[0];
      elements.reminderTime.value = reminderDateObj.toTimeString().substring(0, 5);
      elements.reminderRepeat.value = state.currentReminder.repeat || 'none';
    } else {
      // إذا لم يكن هناك تذكير، استخدام القيم الافتراضية
      const now = new Date();
      elements.reminderDate.value = now.toISOString().split('T')[0];
      elements.reminderTime.value = now.toTimeString().substring(0, 5);
      elements.reminderRepeat.value = 'none';
    }
    
    elements.reminderModal.classList.add('active');
  }
  
  /**
   * حفظ التذكير
   */
  function saveReminder() {
    const date = elements.reminderDate.value;
    const time = elements.reminderTime.value;
    const repeat = elements.reminderRepeat.value;
    
    if (!date || !time) {
      showNotification('الرجاء إدخال تاريخ ووقت للتذكير', 'error');
      return;
    }
    
    const dateTime = new Date(`${date}T${time}`);
    
    state.currentReminder = {
      date: dateTime.toISOString(),
      repeat
    };
    
    updateReminderInfo();
    elements.reminderModal.classList.remove('active');
    showNotification('تم إضافة التذكير بنجاح', 'success');
  }
  
  /**
   * تحديث معلومات التذكير
   */
  function updateReminderInfo() {
    if (!state.currentReminder) {
      elements.reminderInfo.textContent = '';
      return;
    }
    
    const date = new Date(state.currentReminder.date);
    const options = { 
      weekday: 'long', 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    };
    
    let info = `التذكير: ${date.toLocaleDateString('ar-EG', options)}`;
    
    if (state.currentReminder.repeat !== 'none') {
      const repeatText = {
        daily: 'يومي',
        weekly: 'أسبوعي',
        monthly: 'شهري'
      }[state.currentReminder.repeat] || state.currentReminder.repeat;
      
      info += ` (${repeatText})`;
    }
    
    elements.reminderInfo.innerHTML = `<i class="fas fa-bell"></i> ${info}`;
  }
  
  /**
   * التحقق من التذكيرات
   */
  function checkReminders() {
    const now = new Date();
    
    state.notes.forEach(note => {
      if (note.reminder) {
        const reminderDate = new Date(note.reminder.date);
        
        if (now >= reminderDate) {
          showNotification(`تذكير: ${note.title}`, 'info');
          
          // إذا كان التذكير متكررًا، تحديث التاريخ
          if (note.reminder.repeat) {
            const updatedDate = new Date(reminderDate);
            
            switch (note.reminder.repeat) {
              case 'daily':
                updatedDate.setDate(updatedDate.getDate() + 1);
                break;
              case 'weekly':
                updatedDate.setDate(updatedDate.getDate() + 7);
                break;
              case 'monthly':
                updatedDate.setMonth(updatedDate.getMonth() + 1);
                break;
            }
            
            note.reminder.date = updatedDate.toISOString();
            saveToLocalStorage();
          }
        }
      }
    });
  }
  
  // ======================
  // وظائف الصور
  // ======================
  
  /**
   * فتح نافذة تحميل الصورة
   */
  function openImageUploadModal() {
    elements.imageUploadModal.classList.add('active');
  }
  
  /**
   * تحميل صورة من الملف
   */
  function handleImageUpload(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    if (!file.type.match('image.*')) {
      showNotification('الرجاء اختيار ملف صورة', 'error');
      return;
    }
    
    const reader = new FileReader();
    reader.onload = (event) => {
      state.currentImage = event.target.result;
      elements.imagePreview.innerHTML = `<img src="${state.currentImage}" alt="صورة الملاحظة">`;
      elements.imagePreview.style.display = 'block';
      elements.imageUploadModal.classList.remove('active');
      showNotification('تم تحميل الصورة بنجاح', 'success');
    };
    reader.readAsDataURL(file);
  }
  
  /**
   * تحميل صورة من الرابط
   */
  function loadImageFromUrl() {
    const url = elements.imageUrlInput.value.trim();
    if (!url) {
      showNotification('الرجاء إدخال رابط الصورة', 'error');
      return;
    }
    
    // التحقق من أن الرابط يحتوي على امتداد صورة
    const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp'];
    const isImage = imageExtensions.some(ext => url.toLowerCase().endsWith(ext));
    
    if (!isImage) {
      showNotification('الرجاء إدخال رابط صورة صالح', 'error');
      return;
    }
    
    state.currentImage = url;
    elements.imagePreview.innerHTML = `<img src="${state.currentImage}" alt="صورة الملاحظة">`;
    elements.imagePreview.style.display = 'block';
    elements.imageUrlInput.value = '';
    elements.imageUploadModal.classList.remove('active');
    showNotification('تم تحميل الصورة بنجاح', 'success');
  }
  
  // ======================
  // وظائف تنسيق النص
  // ======================
  
  /**
   * فتح نافذة تنسيق النص
   */
  function openFormatModal() {
    elements.formatModal.classList.add('active');
  }
  
  /**
   * تطبيق تنسيق النص
   */
  function applyTextFormat(format) {
    const textarea = elements.noteContent;
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const selectedText = textarea.value.substring(start, end);
    let formattedText = '';
    
    switch (format) {
      case 'bold':
        formattedText = `**${selectedText}**`;
        break;
      case 'italic':
        formattedText = `_${selectedText}_`;
        break;
      case 'underline':
        formattedText = `<u>${selectedText}</u>`;
        break;
      case 'heading':
        formattedText = `## ${selectedText}`;
        break;
      case 'list-ul':
        formattedText = `- ${selectedText}`;
        break;
      case 'list-ol':
        formattedText = `1. ${selectedText}`;
        break;
      case 'link':
        formattedText = `[${selectedText}](https://)`;
        break;
      default:
        formattedText = selectedText;
    }
    
    textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
    elements.formatModal.classList.remove('active');
  }
  
  // ======================
  // وظائف التصدير
  // ======================
  
  /**
   * تصدير إلى PDF
   */
  function exportToPdf() {
    if (state.notes.length === 0) {
      showNotification('لا توجد ملاحظات لتصديرها', 'warning');
      return;
    }
    
    const docDefinition = {
      content: [
        { text: 'ملاحظاتي', style: 'header' },
        { text: `تم التصدير في: ${new Date().toLocaleDateString('ar-EG')}`, style: 'subheader' },
        { text: '\n\n' },
        ...state.notes.map(note => ({
          text: note.title,
          style: 'noteTitle',
          margin: [0, 10, 0, 5]
        }), {
          text: note.content,
          style: 'noteContent',
          margin: [0, 0, 0, 15]
        })
      ],
      styles: {
        header: {
          fontSize: 24,
          bold: true,
          alignment: 'right'
        },
        subheader: {
          fontSize: 12,
          alignment: 'right',
          color: '#666'
        },
        noteTitle: {
          fontSize: 16,
          bold: true,
          color: '#2c3e50',
          alignment: 'right'
        },
        noteContent: {
          fontSize: 12,
          color: '#34495e',
          alignment: 'right'
        }
      },
      defaultStyle: {
        font: 'Tajawal'
      }
    };
    
    pdfMake.createPdf(docDefinition).download('ملاحظاتي.pdf');
    showNotification('تم تصدير الملاحظات إلى PDF', 'success');
  }
  
  /**
   * تصدير إلى نص
   */
  function exportToTxt() {
    if (state.notes.length === 0) {
      showNotification('لا توجد ملاحظات لتصديرها', 'warning');
      return;
    }
    
    let txtContent = 'ملاحظاتي\n\n';
    txtContent += `تم التصدير في: ${new Date().toLocaleDateString('ar-EG')}\n\n`;
    
    state.notes.forEach(note => {
      txtContent += `=== ${note.title} ===\n`;
      txtContent += `الفئة: ${getCategoryName(note.category)}\n`;
      txtContent += `تاريخ الإنشاء: ${new Date(note.createdAt).toLocaleDateString('ar-EG')}\n\n`;
      txtContent += `${note.content}\n\n`;
      txtContent += '------------------------\n\n';
    });
    
    const blob = new Blob([txtContent], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'ملاحظاتي.txt';
    a.click();
    URL.revokeObjectURL(url);
    showNotification('تم تصدير الملاحظات إلى ملف نصي', 'success');
  }
  
  // ======================
  // وظائف البحث المتقدم
  // ======================
  
  /**
   * تبديل عرض لوحة البحث المتقدم
   */
  function toggleAdvancedSearch() {
    elements.advancedSearchPanel.style.display = 
      elements.advancedSearchPanel.style.display === 'block' ? 'none' : 'block';
  }
  
  /**
   * تطبيق فلاتر البحث المتقدم
   */
  function applyAdvancedFilters() {
    state.advancedFilters = {
      category: elements.filterCategory.value,
      dateFrom: elements.filterDateFrom.value,
      dateTo: elements.filterDateTo.value
    };
    
    displayNotes();
    elements.advancedSearchPanel.style.display = 'none';
    showNotification('تم تطبيق الفلتر بنجاح', 'success');
  }
  
  // ======================
  // وظائف المزامنة
  // ======================
  
  /**
   * مزامنة مع Firebase
   */
  async function syncWithFirebase() {
    try {
      if (!state.user) {
        // تسجيل الدخول بشكل مجهول إذا لم يكن المستخدم مسجل الدخول
        await auth.signInAnonymously();
        state.user = auth.currentUser;
      }
      
      showNotification('جاري مزامنة الملاحظات...', 'info');
      
      if (state.notes.length === 0) {
        // إذا لم توجد ملاحظات محلية، جلب الملاحظات من Firebase
        const snapshot = await db.collection('notes').where('userId', '==', state.user.uid).get();
        state.notes = snapshot.docs.map(doc => doc.data());
        saveToLocalStorage();
        displayNotes();
        showNotification('تم جلب الملاحظات من السحابة بنجاح', 'success');
      } else {
        // إذا كانت هناك ملاحظات محلية، رفعها إلى Firebase
        const batch = db.batch();
        const notesRef = db.collection('notes');
        
        // حذف جميع ملاحظات المستخدم أولاً
        const snapshot = await db.collection('notes').where('userId', '==', state.user.uid).get();
        snapshot.docs.forEach(doc => {
          batch.delete(doc.ref);
        });
        
        // إضافة الملاحظات الجديدة
        state.notes.forEach(note => {
          const noteWithUser = { ...note, userId: state.user.uid };
          const newNoteRef = notesRef.doc();
          batch.set(newNoteRef, noteWithUser);
        });
        
        await batch.commit();
        showNotification('تم مزامنة الملاحظات بنجاح', 'success');
      }
    } catch (error) {
      console.error('خطأ في المزامنة:', error);
      showNotification('فشل في المزامنة: ' + error.message, 'error');
    }
  }
  
  // ======================
  // وظائف الواجهة
  // ======================
  
  /**
   * تبديل الوضع الداكن/الفاتح
   */
  function toggleTheme() {
    state.currentTheme = state.currentTheme === 'light' ? 'dark' : 'light';
    applyTheme();
  }
  
  /**
   * تطبيق السمة المختارة
   */
  function applyTheme() {
    document.body.setAttribute('data-theme', state.currentTheme);
    localStorage.setItem('theme', state.currentTheme);
    
    if (state.currentTheme === 'dark') {
      elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
      elements.themeToggle.title = 'الوضع الفاتح';
    } else {
      elements.themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
      elements.themeToggle.title = 'الوضع الداكن';
    }
  }
  
  /**
   * تحديث الوقت والتاريخ
   */
  function updateDateTime() {
    const now = new Date();
    
    // التاريخ
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    elements.currentDate.textContent = now.toLocaleDateString('ar-EG', options);
    
    // الوقت
    const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
    elements.currentTime.textContent = now.toLocaleTimeString('ar-EG', timeOptions);
    
    // تحديث آخر تحديث
    elements.lastUpdated.textContent = now.toLocaleTimeString('ar-EG', timeOptions);
  }
  
  /**
   * عرض إشعار
   */
  function showNotification(message, type = 'info') {
    elements.notification.textContent = message;
    elements.notification.className = 'notification';
    
    // إضافة أيقونة حسب النوع
    let icon = '';
    if (type === 'success') icon = 'fa-check-circle';
    else if (type === 'error') icon = 'fa-exclamation-circle';
    else if (type === 'warning') icon = 'fa-exclamation-triangle';
    else icon = 'fa-info-circle';
    
    elements.notification.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
    
    // لون الخلفية حسب النوع
    if (type === 'success') {
      elements.notification.style.background = 'linear-gradient(135deg, #4caf50, #2e7d32)';
    } else if (type === 'error') {
      elements.notification.style.background = 'linear-gradient(135deg, #f44336, #c62828)';
    } else if (type === 'warning') {
      elements.notification.style.background = 'linear-gradient(135deg, #ff9800, #f57c00)';
    } else {
      elements.notification.style.background = 'linear-gradient(135deg, var(--primary-color), var(--secondary-color))';
    }
    
    elements.notification.classList.add('show');
    
    setTimeout(() => {
      elements.notification.classList.remove('show');
    }, 3000);
  }
  
  // ======================
  // وظائف المساعدة
  // ======================
  
  /**
   * الحصول على اسم الفئة
   */
  function getCategoryName(category) {
    const categories = {
      personal: 'شخصية',
      work: 'عمل',
      ideas: 'أفكار',
      shopping: 'تسوق'
    };
    return categories[category] || category;
  }
  
  /**
   * الحصول على أيقونة الفئة
   */
  function getCategoryIcon(category) {
    const icons = {
      personal: 'fa-home',
      work: 'fa-briefcase',
      ideas: 'fa-lightbulb',
      shopping: 'fa-shopping-cart'
    };
    return icons[category] || 'fa-sticky-note';
  }
  
  /**
   * حفظ في localStorage
   */
  function saveToLocalStorage() {
    localStorage.setItem('notes', JSON.stringify(state.notes));
    updateDateTime();
  }
  
  /**
   * تحميل من localStorage
   */
  function loadFromLocalStorage() {
    const savedNotes = localStorage.getItem('notes');
    if (savedNotes) {
      state.notes = JSON.parse(savedNotes);
    }
  }
  
  // ======================
  // تهيئة التطبيق
  // ======================
  
  // تهيئة تاريخ اليوم للبحث المتقدم
  const today = new Date().toISOString().split('T')[0];
  elements.filterDateFrom.value = today;
  elements.filterDateTo.value = today;
  
  // بدء تشغيل التطبيق
  document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>